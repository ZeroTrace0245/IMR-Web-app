@page "/customers"
@inject IMR_Web_app.Services.IGreenGridService GService

<PageTitle>Customers</PageTitle>

<h1>Customers</h1>

<div class="card p-3 mb-3">
    <h5>Add Customer</h5>
    <EditForm Model="newCustomer" OnValidSubmit="AddCustomer">
        <div class="row">
            <div class="col-md-6 mb-2">
                <InputText class="form-control" @bind-Value="newCustomer.Name" placeholder="Name" />
            </div>
            <div class="col-md-6 mb-2">
                <InputText class="form-control" @bind-Value="newCustomer.CustomerType" placeholder="Type (Household/Business)" />
            </div>
            <div class="col-md-6 mb-2">
                <InputText class="form-control" @bind-Value="newCustomer.Phone" placeholder="Phone" />
            </div>
            <div class="col-md-6 mb-2">
                <InputText class="form-control" @bind-Value="newCustomer.Email" placeholder="Email" />
            </div>
        </div>
        <div class="mt-2">
            <button class="btn btn-success">Add</button>
        </div>
    </EditForm>
</div>

@if (customers == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Ref</th>
                <th>Name</th>
                <th>Type</th>
                <th>Phone</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var c in customers)
            {
                <tr>
                    <td>@c.CustomerRef</td>
                    <td>@c.Name</td>
                    <td>@c.CustomerType</td>
                    <td>@c.Phone</td>
                    <td>@c.Email</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<IMR_Web_app.Services.Models.CustomerModel>? customers;
    private IMR_Web_app.Services.Models.CustomerModel newCustomer = new();

    protected override async Task OnInitializedAsync()
    {
        customers = await GService.GetCustomersAsync();
    }

    private async Task AddCustomer()
    {
        var added = await GService.AddCustomerAsync(newCustomer);
        newCustomer = new();
        customers = await GService.GetCustomersAsync();
    }
}
